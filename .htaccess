# Set proper MIME types for JavaScript modules
<IfModule mod_mime.c>
    AddType application/javascript .js .mjs
    AddType text/javascript .js .mjs
    AddType text/css .css
    AddType image/png .png
    AddType image/x-icon .ico
    AddType application/manifest+json .webmanifest
</IfModule>

# Force correct MIME type for JS files
<FilesMatch "\.m?js$">
    ForceType text/javascript
</FilesMatch>

# Remove any default handlers that might interfere
<IfModule mod_mime.c>
    RemoveHandler .js
    RemoveType .js
    AddType text/javascript .js
</IfModule>

# Enable RewriteEngine for SPA routing
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /

    # Prevent direct access to source files
    RewriteRule ^src(/.*)?$ - [F,L]
    RewriteRule ^node_modules(/.*)?$ - [F,L]
    RewriteRule ^\.env$ - [F,L]

    # Serve production index.html at root
    RewriteRule ^$ dist_running/index.html [L]
    RewriteRule ^index\.html$ dist_running/index.html [L]

    # Rewrite /assets/ requests to dist_running/assets/
    RewriteRule ^assets/(.*)$ dist_running/assets/$1 [L]

    # SPA fallback - if file/directory doesn't exist, serve dist_running/index.html
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule . dist_running/index.html [L]
</IfModule>
