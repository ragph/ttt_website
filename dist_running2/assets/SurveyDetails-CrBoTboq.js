import{a as L,g as U,r as a,u as P,j as e,s as N,c as q,d as B,w as W,I as T,am as H,p as i,t as f,v as F,an as $,ap as V,q as G,x as X,C as z,G as M}from"./index-DOuprDjG.js";import{s as D}from"./surveyApi-ByqOhDSX.js";import{a as Y,b as O}from"./DialogContent-DcNOQ4Em.js";import{S as _}from"./SurveyTabNavigation-3Cu6uPsW.js";import{A as Q}from"./Alert-DRnBkZbr.js";import{C as J}from"./Chip-C_QR9iQq.js";import{C as K,a as Z}from"./CardContent-CLw_rRWi.js";import{C as ee}from"./CardMedia-C-8BBSod.js";import"./axiosClient-C4cdn1Zx.js";function te(t){return L("MuiDialogActions",t)}U("MuiDialogActions",["root","spacing"]);const oe=t=>{const{classes:l,disableSpacing:x}=t;return B({root:["root",!x&&"spacing"]},te,l)},se=N("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(t,l)=>{const{ownerState:x}=t;return[l.root,!x.disableSpacing&&l.spacing]}})({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto",variants:[{props:({ownerState:t})=>!t.disableSpacing,style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),ne=a.forwardRef(function(l,x){const o=P({props:l,name:"MuiDialogActions"}),{className:d,disableSpacing:h=!1,...y}=o,p={...o,disableSpacing:h},u=oe(p);return e.jsx(se,{className:q(u.root,d),ownerState:p,ref:x,...y})}),re=W(e.jsx("path",{d:"M17.77 3.77 16 2 6 12l10 10 1.77-1.77L9.54 12z"})),ae=W(e.jsx("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"})),ie=({candidate:t,open:l,onClose:x,onVote:o})=>{const[d,h]=a.useState(0),[y,p]=a.useState(0),[u,v]=a.useState(0);if(a.useEffect(()=>{h(0)},[t]),!t)return null;const n=t.imageUrls||(t.imageUrl?[t.imageUrl]:[]);console.log("Candidate:",t.text),console.log("Images:",n),console.log("Current index:",d);const S=()=>{h(s=>s===0?n.length-1:s-1)},j=()=>{h(s=>s===n.length-1?0:s+1)},w=()=>{h(0),x()},I=s=>{p(s.targetTouches[0].clientX)},k=s=>{v(s.targetTouches[0].clientX)},A=()=>{if(!y||!u)return;const s=y-u,r=50;s>r?j():s<-r&&S(),p(0),v(0)};return e.jsxs(Y,{open:l,onClose:w,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsx(T,{onClick:w,size:"small",sx:{position:"absolute",right:8,top:8,zIndex:1,color:"white",bgcolor:"rgba(255, 255, 255, 0.1)","&:hover":{bgcolor:"rgba(255, 255, 255, 0.5)"}},children:e.jsx(H,{})}),e.jsxs(O,{sx:{p:0},children:[n.length>0&&e.jsxs(i,{sx:{position:"relative",bgcolor:"black"},onTouchStart:I,onTouchMove:k,onTouchEnd:A,children:[e.jsx(i,{component:"img",src:n[d]||n[0],alt:`${t.text} - Image ${d+1}`,onError:s=>{console.error("Image failed to load:",n[d]),s.target.style.display="none"},sx:{width:"100%",height:"100%",maxHeight:500,objectFit:"contain",display:"block",userSelect:"none",WebkitUserSelect:"none"}}),n.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(T,{onClick:S,sx:{position:"absolute",left:8,top:"50%",transform:"translateY(-50%)",bgcolor:"rgba(255, 255, 255, 0.8)","&:hover":{bgcolor:"rgba(255, 255, 255, 0.9)"}},children:e.jsx(re,{})}),e.jsx(T,{onClick:j,sx:{position:"absolute",right:8,top:"50%",transform:"translateY(-50%)",bgcolor:"rgba(255, 255, 255, 0.8)","&:hover":{bgcolor:"rgba(255, 255, 255, 0.9)"}},children:e.jsx(ae,{})}),e.jsx(i,{sx:{position:"absolute",bottom:16,left:"50%",transform:"translateX(-50%)",display:"flex",gap:1},children:n.map((s,r)=>e.jsx(i,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:r===d?"white":"rgba(255, 255, 255, 0.5)",cursor:"pointer"},onClick:()=>h(r)},r))})]})]}),e.jsxs(i,{sx:{p:3},children:[e.jsx(f,{variant:"h4",sx:{fontWeight:700,mb:2},children:t.text}),t.description&&e.jsx(f,{variant:"body1",color:"text.secondary",sx:{lineHeight:1.8,whiteSpace:"pre-line"},children:t.description})]})]}),e.jsx(ne,{sx:{p:3,pt:0},children:e.jsx(F,{href:"http://etapp.triptravelandtours.com",variant:"contained",size:"large",fullWidth:!0,children:"Vote Now"})})]})},fe=()=>{const{id:t}=$(),l=V(),x=G(),[o,d]=a.useState(null),[h,y]=a.useState(!0),[p,u]=a.useState(null),[v,n]=a.useState(null),[S,j]=a.useState(!1),w=c=>c.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");a.useEffect(()=>{window.scrollTo(0,0)},[]),a.useEffect(()=>{(async()=>{if(t){y(!0),u(null);try{const b=l.state?.surveyId;if(b){const g=await D.getSurveyById(b);g?d(g):u("Survey not found")}else{const C=(await D.getPublicSurveys()).find(m=>w(m.title)===t);if(C){const m=await D.getSurveyById(C.id);m?d(m):u("Survey not found")}else u("Survey not found")}}catch(b){u("Error loading survey"),console.error("Error fetching survey:",b)}y(!1)}})()},[t,l.state]);const I=c=>{n(c),j(!0)},k=()=>{j(!1),n(null)},A=()=>{t&&x(`/surveys/${t}/results`)},s=o?.category.toLowerCase().includes("pageant")||o?.category.toLowerCase().includes("beauty")||o?.title.toLowerCase().includes("miss")||o?.title.toLowerCase().includes("pageant");if(h)return e.jsx(i,{sx:{display:"flex",justifyContent:"center",py:8,minHeight:"100vh"},children:e.jsx(X,{})});if(p||!o)return e.jsx(z,{maxWidth:"lg",sx:{py:8,minHeight:"100vh"},children:e.jsx(Q,{severity:"error",children:p||"Survey not found"})});const r=o.questions.find(c=>c.type==="multiple-choice"||c.type==="multiple_choice");return console.log("All questions:",o.questions),console.log("Voting question:",r),console.log("Voting question options:",r?.options),e.jsxs(i,{sx:{bgcolor:"#ffffff",minHeight:"100vh",py:4,position:"relative","&::before":{content:'""',position:"fixed",top:0,left:0,right:0,bottom:0,backgroundImage:"url(https://images.unsplash.com/photo-1588163308092-5196fe66a63e?q=80&w=2098)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat",opacity:.05,zIndex:0,pointerEvents:"none"}},children:[e.jsxs(z,{maxWidth:"lg",sx:{position:"relative",zIndex:1},children:[s&&e.jsx(_,{activeTab:"general",onGeneralClick:()=>{},onTallyClick:A}),e.jsxs(i,{sx:{textAlign:"center",mb:6},children:[e.jsx(J,{label:o.category,color:"primary",sx:{mb:2}}),e.jsx(f,{variant:"h1",sx:{fontWeight:700,mb:.5},children:o.title}),e.jsx(f,{variant:"body1",color:"text.secondary",sx:{mb:4},children:o.description}),o.image&&e.jsx(i,{component:"img",src:o.image,alt:o.title,sx:{width:"100%",maxWidth:600,height:"auto",mx:"auto",mb:4,borderRadius:0}}),e.jsx(i,{sx:{textAlign:"center"},children:e.jsxs(f,{variant:"body2",color:"text.secondary",children:[o.totalResponses," responses"]})})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx(i,{sx:{textAlign:"center",mb:4},children:e.jsx(f,{variant:"h4",sx:{fontWeight:700,fontSize:{xs:"1.75rem",md:"2rem"}},children:r.question})}),e.jsx(i,{sx:{maxWidth:1200,mx:"auto"},children:e.jsx(M,{container:!0,spacing:3,justifyContent:"center",children:r.options?.map((c,b)=>{const g=typeof c=="string"?{text:c}:c,C=g.imageUrls?.[0]||g.imageUrl,m=g.text.match(/^(.+?)\s*\((.+?)\)$/),R=m?m[1].trim():g.text,E=m?m[2].trim():"";return e.jsx(M,{size:{xs:12,sm:6,md:4},children:e.jsxs(K,{sx:{cursor:"pointer",display:"flex",flexDirection:"column",borderRadius:2,overflow:"hidden",transition:"transform 0.2s, box-shadow 0.2s",width:"100%",maxWidth:350,mx:"auto","&:hover":{transform:"translateY(-4px)",boxShadow:4}},onClick:()=>I(g),children:[C&&e.jsx(ee,{component:"img",image:C,alt:g.text,sx:{width:"100%",height:350,objectFit:"cover"}}),e.jsxs(Z,{sx:{textAlign:"center",py:2.5,px:2,bgcolor:"background.paper"},children:[e.jsx(f,{variant:"body1",sx:{fontWeight:700,fontSize:"1rem",mb:.5,lineHeight:1.4},children:R}),E&&e.jsx(f,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.85rem"},children:E})]})]})},b)})})})]})]}),v&&e.jsx(ie,{open:S,onClose:k,candidate:v})]})};export{fe as default};
