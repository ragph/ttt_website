import{a as U,g as B,r as d,u as N,j as e,s as P,c as q,d as H,p as E,I as T,ai as F,q as n,v as y,aj as $,al as G,t as V,x as X,C as R,G as z}from"./index-CD3E-CJZ.js";import{s as W}from"./surveyApi-DQayz_UQ.js";import{a as Y,b as O}from"./DialogContent-DDZUjqtt.js";import{B as D}from"./Button-C2tzO3jo.js";import{A as _}from"./Alert-yfaPwCOY.js";import{C as Q}from"./Chip-CvXLLTAA.js";import{C as J,a as K}from"./CardContent-BOrdyL5b.js";import{C as Z}from"./CardMedia-CvQD8jIs.js";import"./axiosClient-CztIwJwH.js";function ee(t){return U("MuiDialogActions",t)}B("MuiDialogActions",["root","spacing"]);const te=t=>{const{classes:r,disableSpacing:l}=t;return H({root:["root",!l&&"spacing"]},ee,r)},oe=P("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:l}=t;return[r.root,!l.disableSpacing&&r.spacing]}})({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto",variants:[{props:({ownerState:t})=>!t.disableSpacing,style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),se=d.forwardRef(function(r,l){const o=N({props:r,name:"MuiDialogActions"}),{className:g,disableSpacing:h=!1,...f}=o,p={...o,disableSpacing:h},u=te(p);return e.jsx(oe,{className:q(u.root,g),ownerState:p,ref:l,...f})}),re=E(e.jsx("path",{d:"M17.77 3.77 16 2 6 12l10 10 1.77-1.77L9.54 12z"})),ne=E(e.jsx("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"})),ae=({candidate:t,open:r,onClose:l,onVote:o})=>{const[g,h]=d.useState(0),[f,p]=d.useState(0),[u,j]=d.useState(0);if(d.useEffect(()=>{h(0)},[t]),!t)return null;const a=t.imageUrls||(t.imageUrl?[t.imageUrl]:[]);console.log("Candidate:",t.text),console.log("Images:",a),console.log("Current index:",g);const S=()=>{h(s=>s===0?a.length-1:s-1)},v=()=>{h(s=>s===a.length-1?0:s+1)},w=()=>{h(0),l()},I=s=>{p(s.targetTouches[0].clientX)},k=s=>{j(s.targetTouches[0].clientX)},A=()=>{if(!f||!u)return;const s=f-u,i=50;s>i?v():s<-i&&S(),p(0),j(0)};return e.jsxs(Y,{open:r,onClose:w,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsx(T,{onClick:w,size:"small",sx:{position:"absolute",right:8,top:8,zIndex:1,color:"white",bgcolor:"rgba(255, 255, 255, 0.1)","&:hover":{bgcolor:"rgba(255, 255, 255, 0.5)"}},children:e.jsx(F,{})}),e.jsxs(O,{sx:{p:0},children:[a.length>0&&e.jsxs(n,{sx:{position:"relative",bgcolor:"black"},onTouchStart:I,onTouchMove:k,onTouchEnd:A,children:[e.jsx(n,{component:"img",src:a[g]||a[0],alt:`${t.text} - Image ${g+1}`,onError:s=>{console.error("Image failed to load:",a[g]),s.target.style.display="none"},sx:{width:"100%",height:"100%",maxHeight:500,objectFit:"contain",display:"block",userSelect:"none",WebkitUserSelect:"none"}}),a.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(T,{onClick:S,sx:{position:"absolute",left:8,top:"50%",transform:"translateY(-50%)",bgcolor:"rgba(255, 255, 255, 0.8)","&:hover":{bgcolor:"rgba(255, 255, 255, 0.9)"}},children:e.jsx(re,{})}),e.jsx(T,{onClick:v,sx:{position:"absolute",right:8,top:"50%",transform:"translateY(-50%)",bgcolor:"rgba(255, 255, 255, 0.8)","&:hover":{bgcolor:"rgba(255, 255, 255, 0.9)"}},children:e.jsx(ne,{})}),e.jsx(n,{sx:{position:"absolute",bottom:16,left:"50%",transform:"translateX(-50%)",display:"flex",gap:1},children:a.map((s,i)=>e.jsx(n,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:i===g?"white":"rgba(255, 255, 255, 0.5)",cursor:"pointer"},onClick:()=>h(i)},i))})]})]}),e.jsxs(n,{sx:{p:3},children:[e.jsx(y,{variant:"h4",sx:{fontWeight:700,mb:2},children:t.text}),t.description&&e.jsx(y,{variant:"body1",color:"text.secondary",sx:{lineHeight:1.8,whiteSpace:"pre-line"},children:t.description})]})]}),e.jsx(se,{sx:{p:3,pt:0},children:e.jsx(D,{href:"https://app.earningwhiletravelling.com/login",variant:"contained",size:"large",fullWidth:!0,children:"Vote Now"})})]})},ie=({activeTab:t,onGeneralClick:r,onTallyClick:l})=>e.jsxs(n,{sx:{mb:4,display:"flex",justifyContent:"center",gap:2},children:[e.jsx(D,{variant:t==="general"?"contained":"outlined",onClick:r,sx:{px:4,py:1.5,fontSize:"1rem",fontWeight:600,borderRadius:2,textTransform:"none",...t==="general"?{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"}}:{borderColor:"primary.main",color:"primary.main","&:hover":{borderColor:"primary.dark",bgcolor:"rgba(59, 130, 246, 0.04)"}}},children:"General"}),e.jsx(D,{variant:t==="tally"?"contained":"outlined",onClick:l,sx:{px:4,py:1.5,fontSize:"1rem",fontWeight:600,borderRadius:2,textTransform:"none",...t==="tally"?{bgcolor:"primary.main",color:"white","&:hover":{bgcolor:"primary.dark"}}:{borderColor:"primary.main",color:"primary.main","&:hover":{borderColor:"primary.dark",bgcolor:"rgba(59, 130, 246, 0.04)"}}},children:"Tally Board"})]}),ye=()=>{const{id:t}=$(),r=G(),l=V(),[o,g]=d.useState(null),[h,f]=d.useState(!0),[p,u]=d.useState(null),[j,a]=d.useState(null),[S,v]=d.useState(!1),w=c=>c.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");d.useEffect(()=>{(async()=>{if(t){f(!0),u(null);try{const b=r.state?.surveyId;if(b){const x=await W.getSurveyById(b);x?g(x):u("Survey not found")}else{const C=(await W.getPublicSurveys()).find(m=>w(m.title)===t);if(C){const m=await W.getSurveyById(C.id);m?g(m):u("Survey not found")}else u("Survey not found")}}catch(b){u("Error loading survey"),console.error("Error fetching survey:",b)}f(!1)}})()},[t,r.state]);const I=c=>{a(c),v(!0)},k=()=>{v(!1),a(null)},A=()=>{t&&l(`/surveys/${t}/results`)},s=o?.category.toLowerCase().includes("pageant")||o?.category.toLowerCase().includes("beauty")||o?.title.toLowerCase().includes("miss")||o?.title.toLowerCase().includes("pageant");if(h)return e.jsx(n,{sx:{display:"flex",justifyContent:"center",py:8,minHeight:"100vh"},children:e.jsx(X,{})});if(p||!o)return e.jsx(R,{maxWidth:"lg",sx:{py:8,minHeight:"100vh"},children:e.jsx(_,{severity:"error",children:p||"Survey not found"})});const i=o.questions.find(c=>c.type==="multiple-choice"||c.type==="multiple_choice");return console.log("All questions:",o.questions),console.log("Voting question:",i),console.log("Voting question options:",i?.options),e.jsxs(n,{sx:{bgcolor:"background.default",minHeight:"100vh",py:4},children:[e.jsxs(R,{maxWidth:"lg",children:[s&&e.jsx(ie,{activeTab:"general",onGeneralClick:()=>{},onTallyClick:A}),e.jsxs(n,{sx:{textAlign:"center",mb:4},children:[e.jsx(Q,{label:o.category,color:"primary",sx:{mb:2}}),e.jsx(y,{variant:"h3",sx:{fontWeight:700,mb:2},children:o.title}),e.jsx(y,{variant:"body1",color:"text.secondary",sx:{mb:4},children:o.description}),o.image&&e.jsx(n,{component:"img",src:o.image,alt:o.title,sx:{width:"100%",maxWidth:600,height:"auto",mx:"auto",mb:4,borderRadius:2}}),e.jsx(n,{sx:{textAlign:"center"},children:e.jsxs(y,{variant:"body2",color:"text.secondary",children:[o.totalResponses," responses"]})})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx(n,{sx:{textAlign:"center",mb:4},children:e.jsx(y,{variant:"h4",sx:{fontWeight:700,fontSize:{xs:"1.75rem",md:"2rem"}},children:i.question})}),e.jsx(n,{sx:{maxWidth:1200,mx:"auto"},children:e.jsx(z,{container:!0,spacing:3,justifyContent:"center",children:i.options?.map((c,b)=>{const x=typeof c=="string"?{text:c}:c,C=x.imageUrls?.[0]||x.imageUrl,m=x.text.match(/^(.+?)\s*\((.+?)\)$/),L=m?m[1].trim():x.text,M=m?m[2].trim():"";return e.jsx(z,{size:{xs:12,sm:6,md:4},children:e.jsxs(J,{sx:{cursor:"pointer",display:"flex",flexDirection:"column",borderRadius:2,overflow:"hidden",transition:"transform 0.2s, box-shadow 0.2s",width:"100%",maxWidth:350,mx:"auto","&:hover":{transform:"translateY(-4px)",boxShadow:4}},onClick:()=>I(x),children:[C&&e.jsx(Z,{component:"img",image:C,alt:x.text,sx:{width:"100%",height:350,objectFit:"cover"}}),e.jsxs(K,{sx:{textAlign:"center",py:2.5,px:2,bgcolor:"background.paper"},children:[e.jsx(y,{variant:"body1",sx:{fontWeight:700,fontSize:"1rem",mb:.5,lineHeight:1.4},children:L}),M&&e.jsx(y,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.85rem"},children:M})]})]})},b)})})})]})]}),j&&e.jsx(ae,{open:S,onClose:k,candidate:j})]})};export{ye as default};
