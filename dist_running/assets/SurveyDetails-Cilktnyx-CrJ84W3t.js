import{aj as R,al as q,c as H,S as d,_ as e,w as a,f as U,r as L,y as m,L as T,E as z,af as V,d as E,g as D,V as N,x as F,l as X,v as _,n as P}from"./index-Blp7pDh0.js";import{y as A}from"./surveyApi-BRzGWbYD-BOEn-2ZY.js";import{W as Y,T as B}from"./DialogContent-D2Ex4EUD-CLCrI9aR.js";import{l as G}from"./Button-DyjhcOar-BfSno0Iw.js";import{m as J}from"./SurveyTabNavigation-CPtoi0Td-BonC0Ug0.js";import{p as K}from"./Alert-CfHVDE2R-DCg80Bvk.js";import{v as O}from"./Chip-BseTIWvc-CThzy0i9.js";import{j as Q,N as Z}from"./CardContent-Cf2urb3M-D7qdtt7G.js";import{w as ee}from"./CardMedia-C_oDLxF8-glz2fq1Q.js";import"./axiosClient-CWaqpX3y-DsLiUPjC.js";function te(t){return _("MuiDialogActions",t)}P("MuiDialogActions",["root","spacing"]);const oe=t=>{const{classes:l,disableSpacing:x}=t;return X({root:["root",!x&&"spacing"]},te,l)},se=N("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(t,l)=>{const{ownerState:x}=t;return[l.root,!x.disableSpacing&&l.spacing]}})({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto",variants:[{props:({ownerState:t})=>!t.disableSpacing,style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),re=d.forwardRef(function(t,l){const x=D({props:t,name:"MuiDialogActions"}),{className:o,disableSpacing:g=!1,...u}=x,h={...x,disableSpacing:g},f=oe(h);return e.jsx(se,{className:F(f.root,o),ownerState:h,ref:l,...u})}),ne=E(e.jsx("path",{d:"M17.77 3.77 16 2 6 12l10 10 1.77-1.77L9.54 12z"})),ie=E(e.jsx("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"})),ae=({candidate:t,open:l,onClose:x,onVote:o})=>{const[g,u]=d.useState(0),[h,f]=d.useState(0),[p,y]=d.useState(0);if(d.useEffect(()=>{u(0)},[t]),!t)return null;const n=t.imageUrls||(t.imageUrl?[t.imageUrl]:[]);console.log("Candidate:",t.text),console.log("Images:",n),console.log("Current index:",g);const v=()=>{u(s=>s===0?n.length-1:s-1)},j=()=>{u(s=>s===n.length-1?0:s+1)},S=()=>{u(0),x()},C=s=>{f(s.targetTouches[0].clientX)},W=s=>{y(s.targetTouches[0].clientX)},k=()=>{if(!h||!p)return;const s=h-p,i=50;s>i?j():s<-i&&v(),f(0),y(0)};return e.jsxs(Y,{open:l,onClose:S,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsx(z,{onClick:S,size:"small",sx:{position:"absolute",right:8,top:8,zIndex:1,color:"white",bgcolor:"rgba(255, 255, 255, 0.1)","&:hover":{bgcolor:"rgba(255, 255, 255, 0.5)"}},children:e.jsx(V,{})}),e.jsxs(B,{sx:{p:0},children:[n.length>0&&e.jsxs(a,{sx:{position:"relative",bgcolor:"black"},onTouchStart:C,onTouchMove:W,onTouchEnd:k,children:[e.jsx(a,{component:"img",src:n[g]||n[0],alt:`${t.text} - Image ${g+1}`,onError:s=>{console.error("Image failed to load:",n[g]),s.target.style.display="none"},sx:{width:"100%",height:"100%",maxHeight:500,objectFit:"contain",display:"block",userSelect:"none",WebkitUserSelect:"none"}}),n.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(z,{onClick:v,sx:{position:"absolute",left:8,top:"50%",transform:"translateY(-50%)",bgcolor:"rgba(255, 255, 255, 0.8)","&:hover":{bgcolor:"rgba(255, 255, 255, 0.9)"}},children:e.jsx(ne,{})}),e.jsx(z,{onClick:j,sx:{position:"absolute",right:8,top:"50%",transform:"translateY(-50%)",bgcolor:"rgba(255, 255, 255, 0.8)","&:hover":{bgcolor:"rgba(255, 255, 255, 0.9)"}},children:e.jsx(ie,{})}),e.jsx(a,{sx:{position:"absolute",bottom:16,left:"50%",transform:"translateX(-50%)",display:"flex",gap:1},children:n.map((s,i)=>e.jsx(a,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:i===g?"white":"rgba(255, 255, 255, 0.5)",cursor:"pointer"},onClick:()=>u(i)},i))})]})]}),e.jsxs(a,{sx:{p:3},children:[e.jsx(m,{variant:"h4",sx:{fontWeight:700,mb:2},children:t.text}),t.description&&e.jsx(m,{variant:"body1",color:"text.secondary",sx:{lineHeight:1.8,whiteSpace:"pre-line"},children:t.description})]})]}),e.jsx(re,{sx:{p:3,pt:0},children:e.jsx(G,{href:"https://app.earningwhiletravelling.com/login",variant:"contained",size:"large",fullWidth:!0,children:"Vote Now"})})]})},be=()=>{const{id:t}=R(),l=q(),x=H(),[o,g]=d.useState(null),[u,h]=d.useState(!0),[f,p]=d.useState(null),[y,n]=d.useState(null),[v,j]=d.useState(!1),S=r=>r.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");d.useEffect(()=>{(async()=>{if(t){h(!0),p(null);try{const r=l.state?.surveyId;if(r){const b=await A.getSurveyById(r);b?g(b):p("Survey not found")}else{const b=(await A.getPublicSurveys()).find(c=>S(c.title)===t);if(b){const c=await A.getSurveyById(b.id);c?g(c):p("Survey not found")}else p("Survey not found")}}catch(r){p("Error loading survey"),console.error("Error fetching survey:",r)}h(!1)}})()},[t,l.state]);const C=r=>{n(r),j(!0)},W=()=>{j(!1),n(null)},k=()=>{t&&x(`/surveys/${t}/results`)},s=o?.category.toLowerCase().includes("pageant")||o?.category.toLowerCase().includes("beauty")||o?.title.toLowerCase().includes("miss")||o?.title.toLowerCase().includes("pageant");if(u)return e.jsx(a,{sx:{display:"flex",justifyContent:"center",py:8,minHeight:"100vh"},children:e.jsx(U,{})});if(f||!o)return e.jsx(L,{maxWidth:"lg",sx:{py:8,minHeight:"100vh"},children:e.jsx(K,{severity:"error",children:f||"Survey not found"})});const i=o.questions.find(r=>r.type==="multiple-choice"||r.type==="multiple_choice");return console.log("All questions:",o.questions),console.log("Voting question:",i),console.log("Voting question options:",i?.options),e.jsxs(a,{sx:{bgcolor:"background.default",minHeight:"100vh",py:4},children:[e.jsxs(L,{maxWidth:"lg",children:[s&&e.jsx(J,{activeTab:"general",onGeneralClick:()=>{},onTallyClick:k}),e.jsxs(a,{sx:{textAlign:"center",mb:4},children:[e.jsx(O,{label:o.category,color:"primary",sx:{mb:2}}),e.jsx(m,{variant:"h3",sx:{fontWeight:700,mb:2},children:o.title}),e.jsx(m,{variant:"body1",color:"text.secondary",sx:{mb:4},children:o.description}),o.image&&e.jsx(a,{component:"img",src:o.image,alt:o.title,sx:{width:"100%",maxWidth:600,height:"auto",mx:"auto",mb:4,borderRadius:2}}),e.jsx(a,{sx:{textAlign:"center"},children:e.jsxs(m,{variant:"body2",color:"text.secondary",children:[o.totalResponses," responses"]})})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx(a,{sx:{textAlign:"center",mb:4},children:e.jsx(m,{variant:"h4",sx:{fontWeight:700,fontSize:{xs:"1.75rem",md:"2rem"}},children:i.question})}),e.jsx(a,{sx:{maxWidth:1200,mx:"auto"},children:e.jsx(T,{container:!0,spacing:3,justifyContent:"center",children:i.options?.map((r,b)=>{const c=typeof r=="string"?{text:r}:r,$=c.imageUrls?.[0]||c.imageUrl,w=c.text.match(/^(.+?)\s*\((.+?)\)$/),M=w?w[1].trim():c.text,I=w?w[2].trim():"";return e.jsx(T,{size:{xs:12,sm:6,md:4},children:e.jsxs(Q,{sx:{cursor:"pointer",display:"flex",flexDirection:"column",borderRadius:2,overflow:"hidden",transition:"transform 0.2s, box-shadow 0.2s",width:"100%",maxWidth:350,mx:"auto","&:hover":{transform:"translateY(-4px)",boxShadow:4}},onClick:()=>C(c),children:[$&&e.jsx(ee,{component:"img",image:$,alt:c.text,sx:{width:"100%",height:350,objectFit:"cover"}}),e.jsxs(Z,{sx:{textAlign:"center",py:2.5,px:2,bgcolor:"background.paper"},children:[e.jsx(m,{variant:"body1",sx:{fontWeight:700,fontSize:"1rem",mb:.5,lineHeight:1.4},children:M}),I&&e.jsx(m,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.85rem"},children:I})]})]})},b)})})})]})]}),y&&e.jsx(ae,{open:v,onClose:W,candidate:y})]})};export{be as default};
