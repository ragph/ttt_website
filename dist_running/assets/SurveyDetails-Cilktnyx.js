import{a as L,g as U,r as c,u as N,j as e,s as P,c as B,d as q,p as R,I as T,ai as H,q as a,v as f,aj as F,al as $,t as V,x as G,C as W,G as E}from"./index-BI7POapL.js";import{s as D}from"./surveyApi-BRzGWbYD.js";import{a as X,b as Y}from"./DialogContent-D2Ex4EUD.js";import{B as O}from"./Button-DyjhcOar.js";import{S as _}from"./SurveyTabNavigation-CPtoi0Td.js";import{A as Q}from"./Alert-CfHVDE2R.js";import{C as J}from"./Chip-BseTIWvc.js";import{C as K,a as Z}from"./CardContent-Cf2urb3M.js";import{C as ee}from"./CardMedia-C_oDLxF8.js";import"./axiosClient-CWaqpX3y.js";function te(t){return L("MuiDialogActions",t)}U("MuiDialogActions",["root","spacing"]);const se=t=>{const{classes:i,disableSpacing:x}=t;return q({root:["root",!x&&"spacing"]},te,i)},oe=P("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(t,i)=>{const{ownerState:x}=t;return[i.root,!x.disableSpacing&&i.spacing]}})({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto",variants:[{props:({ownerState:t})=>!t.disableSpacing,style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),ne=c.forwardRef(function(i,x){const s=N({props:i,name:"MuiDialogActions"}),{className:d,disableSpacing:h=!1,...y}=s,p={...s,disableSpacing:h},u=se(p);return e.jsx(oe,{className:B(u.root,d),ownerState:p,ref:x,...y})}),re=R(e.jsx("path",{d:"M17.77 3.77 16 2 6 12l10 10 1.77-1.77L9.54 12z"})),ae=R(e.jsx("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"})),ie=({candidate:t,open:i,onClose:x,onVote:s})=>{const[d,h]=c.useState(0),[y,p]=c.useState(0),[u,j]=c.useState(0);if(c.useEffect(()=>{h(0)},[t]),!t)return null;const n=t.imageUrls||(t.imageUrl?[t.imageUrl]:[]);console.log("Candidate:",t.text),console.log("Images:",n),console.log("Current index:",d);const S=()=>{h(o=>o===0?n.length-1:o-1)},v=()=>{h(o=>o===n.length-1?0:o+1)},w=()=>{h(0),x()},I=o=>{p(o.targetTouches[0].clientX)},A=o=>{j(o.targetTouches[0].clientX)},k=()=>{if(!y||!u)return;const o=y-u,r=50;o>r?v():o<-r&&S(),p(0),j(0)};return e.jsxs(X,{open:i,onClose:w,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:2}},children:[e.jsx(T,{onClick:w,size:"small",sx:{position:"absolute",right:8,top:8,zIndex:1,color:"white",bgcolor:"rgba(255, 255, 255, 0.1)","&:hover":{bgcolor:"rgba(255, 255, 255, 0.5)"}},children:e.jsx(H,{})}),e.jsxs(Y,{sx:{p:0},children:[n.length>0&&e.jsxs(a,{sx:{position:"relative",bgcolor:"black"},onTouchStart:I,onTouchMove:A,onTouchEnd:k,children:[e.jsx(a,{component:"img",src:n[d]||n[0],alt:`${t.text} - Image ${d+1}`,onError:o=>{console.error("Image failed to load:",n[d]),o.target.style.display="none"},sx:{width:"100%",height:"100%",maxHeight:500,objectFit:"contain",display:"block",userSelect:"none",WebkitUserSelect:"none"}}),n.length>1&&e.jsxs(e.Fragment,{children:[e.jsx(T,{onClick:S,sx:{position:"absolute",left:8,top:"50%",transform:"translateY(-50%)",bgcolor:"rgba(255, 255, 255, 0.8)","&:hover":{bgcolor:"rgba(255, 255, 255, 0.9)"}},children:e.jsx(re,{})}),e.jsx(T,{onClick:v,sx:{position:"absolute",right:8,top:"50%",transform:"translateY(-50%)",bgcolor:"rgba(255, 255, 255, 0.8)","&:hover":{bgcolor:"rgba(255, 255, 255, 0.9)"}},children:e.jsx(ae,{})}),e.jsx(a,{sx:{position:"absolute",bottom:16,left:"50%",transform:"translateX(-50%)",display:"flex",gap:1},children:n.map((o,r)=>e.jsx(a,{sx:{width:8,height:8,borderRadius:"50%",bgcolor:r===d?"white":"rgba(255, 255, 255, 0.5)",cursor:"pointer"},onClick:()=>h(r)},r))})]})]}),e.jsxs(a,{sx:{p:3},children:[e.jsx(f,{variant:"h4",sx:{fontWeight:700,mb:2},children:t.text}),t.description&&e.jsx(f,{variant:"body1",color:"text.secondary",sx:{lineHeight:1.8,whiteSpace:"pre-line"},children:t.description})]})]}),e.jsx(ne,{sx:{p:3,pt:0},children:e.jsx(O,{href:"https://app.earningwhiletravelling.com/login",variant:"contained",size:"large",fullWidth:!0,children:"Vote Now"})})]})},ye=()=>{const{id:t}=F(),i=$(),x=V(),[s,d]=c.useState(null),[h,y]=c.useState(!0),[p,u]=c.useState(null),[j,n]=c.useState(null),[S,v]=c.useState(!1),w=l=>l.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");c.useEffect(()=>{(async()=>{if(t){y(!0),u(null);try{const b=i.state?.surveyId;if(b){const g=await D.getSurveyById(b);g?d(g):u("Survey not found")}else{const C=(await D.getPublicSurveys()).find(m=>w(m.title)===t);if(C){const m=await D.getSurveyById(C.id);m?d(m):u("Survey not found")}else u("Survey not found")}}catch(b){u("Error loading survey"),console.error("Error fetching survey:",b)}y(!1)}})()},[t,i.state]);const I=l=>{n(l),v(!0)},A=()=>{v(!1),n(null)},k=()=>{t&&x(`/surveys/${t}/results`)},o=s?.category.toLowerCase().includes("pageant")||s?.category.toLowerCase().includes("beauty")||s?.title.toLowerCase().includes("miss")||s?.title.toLowerCase().includes("pageant");if(h)return e.jsx(a,{sx:{display:"flex",justifyContent:"center",py:8,minHeight:"100vh"},children:e.jsx(G,{})});if(p||!s)return e.jsx(W,{maxWidth:"lg",sx:{py:8,minHeight:"100vh"},children:e.jsx(Q,{severity:"error",children:p||"Survey not found"})});const r=s.questions.find(l=>l.type==="multiple-choice"||l.type==="multiple_choice");return console.log("All questions:",s.questions),console.log("Voting question:",r),console.log("Voting question options:",r?.options),e.jsxs(a,{sx:{bgcolor:"background.default",minHeight:"100vh",py:4},children:[e.jsxs(W,{maxWidth:"lg",children:[o&&e.jsx(_,{activeTab:"general",onGeneralClick:()=>{},onTallyClick:k}),e.jsxs(a,{sx:{textAlign:"center",mb:4},children:[e.jsx(J,{label:s.category,color:"primary",sx:{mb:2}}),e.jsx(f,{variant:"h3",sx:{fontWeight:700,mb:2},children:s.title}),e.jsx(f,{variant:"body1",color:"text.secondary",sx:{mb:4},children:s.description}),s.image&&e.jsx(a,{component:"img",src:s.image,alt:s.title,sx:{width:"100%",maxWidth:600,height:"auto",mx:"auto",mb:4,borderRadius:2}}),e.jsx(a,{sx:{textAlign:"center"},children:e.jsxs(f,{variant:"body2",color:"text.secondary",children:[s.totalResponses," responses"]})})]}),r&&e.jsxs(e.Fragment,{children:[e.jsx(a,{sx:{textAlign:"center",mb:4},children:e.jsx(f,{variant:"h4",sx:{fontWeight:700,fontSize:{xs:"1.75rem",md:"2rem"}},children:r.question})}),e.jsx(a,{sx:{maxWidth:1200,mx:"auto"},children:e.jsx(E,{container:!0,spacing:3,justifyContent:"center",children:r.options?.map((l,b)=>{const g=typeof l=="string"?{text:l}:l,C=g.imageUrls?.[0]||g.imageUrl,m=g.text.match(/^(.+?)\s*\((.+?)\)$/),z=m?m[1].trim():g.text,M=m?m[2].trim():"";return e.jsx(E,{size:{xs:12,sm:6,md:4},children:e.jsxs(K,{sx:{cursor:"pointer",display:"flex",flexDirection:"column",borderRadius:2,overflow:"hidden",transition:"transform 0.2s, box-shadow 0.2s",width:"100%",maxWidth:350,mx:"auto","&:hover":{transform:"translateY(-4px)",boxShadow:4}},onClick:()=>I(g),children:[C&&e.jsx(ee,{component:"img",image:C,alt:g.text,sx:{width:"100%",height:350,objectFit:"cover"}}),e.jsxs(Z,{sx:{textAlign:"center",py:2.5,px:2,bgcolor:"background.paper"},children:[e.jsx(f,{variant:"body1",sx:{fontWeight:700,fontSize:"1rem",mb:.5,lineHeight:1.4},children:z}),M&&e.jsx(f,{variant:"body2",color:"text.secondary",sx:{fontSize:"0.85rem"},children:M})]})]})},b)})})})]})]}),j&&e.jsx(ie,{open:S,onClose:A,candidate:j})]})};export{ye as default};
